#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
"""
import sys
import os
sys.path.append('..')

import asyncio
from telegram import Bot
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

async def test_new_token():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω"""
    print("üîë –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ù–û–í–û–ì–û –¢–û–ö–ï–ù–ê")
    print("=" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    bot_token = os.getenv('BOT_TOKEN')
    chat_id = os.getenv('CHAT_ID')
    
    if not bot_token:
        print("‚ùå BOT_TOKEN –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        print("–í GitHub Actions —Ç–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö")
        return
    
    if not chat_id:
        print("‚ùå CHAT_ID –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        print("–í GitHub Actions CHAT_ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö")
        return
    
    print(f"‚úÖ BOT_TOKEN –Ω–∞–π–¥–µ–Ω (–¥–ª–∏–Ω–∞: {len(bot_token)})")
    print(f"‚úÖ CHAT_ID –Ω–∞–π–¥–µ–Ω: {chat_id}")
    print(f"–ü–µ—Ä–≤—ã–µ 10 —Å–∏–º–≤–æ–ª–æ–≤ —Ç–æ–∫–µ–Ω–∞: {bot_token[:10]}...")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å—Ç–∞—Ä—ã–π –ª–∏ —ç—Ç–æ —Ç–æ–∫–µ–Ω
    if bot_token.startswith("7772125141"):
        print("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω!")
        print("–û–±–Ω–æ–≤–∏—Ç–µ BOT_TOKEN –≤ GitHub Secrets")
        return
    
    try:
        # –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
        bot = Bot(token=bot_token)
        print("‚úÖ –ë–æ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ")
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        test_message = "üß™ –¢–ï–°–¢ –ù–û–í–û–ì–û –¢–û–ö–ï–ù–ê\n\n‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º!\n\nüïê –í—Ä–µ–º—è: " + str(asyncio.get_event_loop().time())
        
        await bot.send_message(chat_id=chat_id, text=test_message)
        print("‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!")
        print("üéâ –ù–û–í–´–ô –¢–û–ö–ï–ù –†–ê–ë–û–¢–ê–ï–¢ –ö–û–†–†–ï–ö–¢–ù–û!")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞: {e}")
        if "Unauthorized" in str(e):
            print("üîç –ü—Ä–æ–±–ª–µ–º–∞: –¢–æ–∫–µ–Ω –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
            print("–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:")
            print("1. –¢–æ–∫–µ–Ω –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω –≤ GitHub Secrets")
            print("2. –°—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è")
            print("3. –¢–æ–∫–µ–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π")
        elif "Chat not found" in str(e):
            print("üîç –ü—Ä–æ–±–ª–µ–º–∞: –ß–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
            print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ CHAT_ID –≤ GitHub Secrets")
        else:
            print("üîç –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞")
    
    print("\n" + "=" * 50)
    print("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û")

if __name__ == "__main__":
    asyncio.run(test_new_token())
